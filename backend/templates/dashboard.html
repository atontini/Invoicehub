{% extends "base.html" %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <!-- Subtitle -->
    <div class="flex items-center space-x-2">
        <span class="text-gray-600 font-light text-2xl">eCommerce</span>
        <span class="text-gray-400 italic text-sm">Be a best seller...</span>
    </div>
    <h1 class="text-2xl font-bold mb-4">Analytics Dashboard</h1>
      
    <section class="container mx-auto py-20 px-8">
        <div class="mt-6 grid lg:grid-cols-4 md:grid-cols-2 grid-cols-1 items-center md:gap-2.5 gap-4">
          <div class="relative flex flex-col bg-clip-border rounded-xl bg-white text-gray-700 shadow-md shadow-sm border border-gray-200 !rounded-lg">
            <div class="p-6 p-4">
                <div class="flex justify-between items-center">
                    <p class="block antialiased font-sans text-base font-light leading-relaxed text-inherit !font-medium !text-xs text-gray-600">
                        Average Sales
                    </p>
                    <div class="flex items-center gap-1">
                        {% if average_sales.this_month_percentage < 0 %}
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-red-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
                            </svg>
                            <p class="block antialiased font-sans text-base font-light leading-relaxed font-medium !text-xs text-red-500">
                            {{ average_sales.this_month_percentage }}%
                            </p>
                        {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-green-500">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5"></path>
                            </svg>
                            <p class="block antialiased font-sans text-base font-light leading-relaxed text-green-500 font-medium !text-xs" >
                                {{ average_sales.this_month_percentage }}%
                            </p>
                        {% endif %}
                    </div>
                </div>
                <p class="block antialiased font-sans text-base font-light leading-relaxed text-blue-gray-900 mt-1 font-bold text-2xl">
                  {{ average_sales.total_sales }}
                </p>
            </div>
          </div>
          <div class="relative flex flex-col bg-clip-border rounded-xl bg-white text-gray-700 shadow-md shadow-sm border border-gray-200 !rounded-lg">
            <div class="p-6 p-4">
              <div class="flex justify-between items-center">
                <p class="block antialiased font-sans text-base font-light leading-relaxed text-inherit !font-medium !text-xs text-gray-600">
                  Total Sales
                </p>
                <div class="flex items-center gap-1">
                    {% if total_sales.increase_last_month < 0 %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-red-500">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
                        </svg>
                        <p class="block antialiased font-sans text-base font-light leading-relaxed font-medium !text-xs text-red-500">
                          {{ "%.2f" % total_sales.increase_last_month }}%
                        </p>
                    {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-green-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5"></path>
                        </svg>
                        <p class="block antialiased font-sans text-base font-light leading-relaxed text-green-500 font-medium !text-xs" >
                            {{ "%.2f" % total_sales.increase_last_month }}%
                        </p>
                    {% endif %}
                </div>
              </div>
              <p
                class="block antialiased font-sans text-base font-light leading-relaxed text-blue-gray-900 mt-1 font-bold text-2xl"
              >
                {{ total_sales.total }}
              </p>
            </div>
          </div>
          <div
            class="relative flex flex-col bg-clip-border rounded-xl bg-white text-gray-700 shadow-md shadow-sm border border-gray-200 !rounded-lg"
          >
            <div class="p-6 p-4">
              <div class="flex justify-between items-center">
                <p
                  class="block antialiased font-sans text-base font-light leading-relaxed text-inherit !font-medium !text-xs text-gray-600"
                >
                  Total Audience
                </p>
                <div class="flex items-center gap-1">
                    {% if total_inquieries.increase_last_month < 0 %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-red-500">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
                        </svg>
                        <p class="block antialiased font-sans text-base font-light leading-relaxed font-medium !text-xs text-red-500">
                          {{ "%.2f" % total_inquieries.increase_last_month }}%
                        </p>
                    {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-green-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5"></path>
                        </svg>
                        <p class="block antialiased font-sans text-base font-light leading-relaxed text-green-500 font-medium !text-xs" >
                            {{ "%.2f" % total_inquieries.increase_last_month }}%
                        </p>
                    {% endif %}
                </div>
              </div>
              <p class="block antialiased font-sans text-base font-light leading-relaxed text-blue-gray-900 mt-1 font-bold text-2xl">
                {{ total_inquieries.total }}
              </p>
            </div>
          </div>
          <div class="relative flex flex-col bg-clip-border rounded-xl bg-white text-gray-700 shadow-md shadow-sm border border-gray-200 !rounded-lg">
            <div class="p-6 p-4">
              <div class="flex justify-between items-center">
                <p class="block antialiased font-sans text-base font-light leading-relaxed text-inherit !font-medium !text-xs text-gray-600">
                  Invoices
                </p>
                <div class="flex items-center gap-1">
                    {% if total_invoices.increase_last_month < 0 %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-red-500">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
                        </svg>
                        <p class="block antialiased font-sans text-base font-light leading-relaxed font-medium !text-xs text-red-500">
                          {{ "%.2f" % total_invoices.increase_last_month }}%
                        </p>
                    {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="4" stroke="currentColor" aria-hidden="true" class="w-3 h-3 text-green-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5"></path>
                        </svg>
                        <p class="block antialiased font-sans text-base font-light leading-relaxed text-green-500 font-medium !text-xs" >
                            {{ "%.2f" % total_invoices.increase_last_month }}%
                        </p>
                    {% endif %}
                </div>
              </div>
              <p class="block antialiased font-sans text-base font-light leading-relaxed text-blue-gray-900 mt-1 font-bold text-2xl">
                {{ total_invoices.total }}
              </p>
            </div>
          </div>
        </div>
    </section>
      
      

    <!-- Sales Chart -->
    <div class="flex flex-col lg:flex-row gap-4 p-4">
        <!-- Line Chart -->
        <div class="w-full max-w-2xl p-4 bg-white rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Total Sales</h2>
            <canvas id="trendChart"></canvas>
        </div>
          
        <!-- Donut Chart -->
        <div class="w-full lg:w-1/3 bg-white rounded-lg shadow p-4">
            <h2 class="text-lg font-semibold mb-4">Total Sales</h2>
            <canvas id="donutChart" class="w-full h-64"></canvas>
        </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-4 p-4">
        <div class="w-full lg:w-1/3 bg-white rounded-lg shadow p-4">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Product Demand</h2>
            <canvas id="productDemandChart"></canvas>
        </div>

        <div class="w-full max-w-2xl p-4 bg-white rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Average Sales</h2>
            <!--<canvas id="trendChart"></canvas>-->
        </div>
    </div>

    <script>
        const ctx = document.getElementById('trendChart').getContext('2d');
        const trendChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00'],
            datasets: [
              {
                label: 'Profit',
                data: {{ graph_sales.profit }},
                borderColor: '#4F46E5',
                backgroundColor: 'rgba(79, 70, 229, 0.2)',
                tension: 0.4,
                fill: true,
              },
              {
                label: 'Sales',
                data: {{ graph_sales.sales }},
                borderColor: '#F43F5E',
                backgroundColor: 'rgba(244, 63, 94, 0.2)',
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: '#4B5563',
                },
              },
            },
            scales: {
              x: {
                ticks: {
                  color: '#6B7280',
                },
              },
              y: {
                ticks: {
                  color: '#6B7280',
                },
              },
            },
          },
        });

        let categories = [ {% for item in graph_sales['categories'] %} "{{ item }}", {% endfor %} ];

        const ctx1 = document.getElementById('donutChart').getContext('2d');
        const donutChart = new Chart(ctx1, {
          type: 'doughnut',
          data: {
            labels: categories,
            datasets: [
              {
                data: {{ graph_sales.categories_percentage }},
                backgroundColor: ['#4F46E5', '#3B82F6', '#FACC15', '#F43F5E'],
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false,
              },
            },
          },
        });

        const ctx2 = document.getElementById('productDemandChart').getContext('2d');
        const data = {
            labels: categories,
            datasets: [{
                label: 'Popularity',
                data: {{ graph_sales.categories_percentage }},
                backgroundColor: ['#3f51b5', '#e53935', '#43a047', '#ffa000'],
                borderRadius: 5,
                barPercentage: 0.8,
            }]
        };

        const options = {
            indexAxis: 'y',
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 20,
                        font: {
                            size: 14
                        },
                    },
                },
                y: {
                    ticks: {
                        font: {
                            size: 14
                        },
                    },
                },
            },
            plugins: {
                legend: {
                    display: false,
                },
            },
        };

        new Chart(ctx2, {
            type: 'bar',
            data: data,
            options: options,
        });
    </script>
</body>
{% endblock %}